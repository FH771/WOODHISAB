<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BFIDC ULTRA GOD MODE ERP</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');
body{font-family:'Poppins','Segoe UI',Arial;background:radial-gradient(1200px 600px at 20% -10%,#1f2937,#020617 40%,#020617 60%), linear-gradient(180deg,#020617,#020617);margin:0;transition:.3s;color:white}
#loginLayer,#appArea{height:100vh;display:flex;justify-content:center;align-items:center}
/* --- HERO LOGIN --- */
.login-hero{position:relative;display:grid;grid-template-columns:1fr;gap:18px;align-items:center}
.login-glass{background:linear-gradient(180deg,rgba(17,24,39,.9),rgba(2,6,23,.95));backdrop-filter:blur(8px);padding:28px;border-radius:18px;width:340px;box-shadow:0 30px 80px rgba(0,0,0,.6), inset 0 0 0 1px rgba(148,163,184,.15);text-align:center}
.brand{display:flex;gap:12px;align-items:center;justify-content:center;margin-bottom:6px}
.brand .logo{width:54px;height:54px;border-radius:14px;background:linear-gradient(135deg,#22c55e,#16a34a);display:grid;place-items:center;font-weight:800;color:#022c22;box-shadow:0 10px 30px rgba(34,197,94,.35)}
.brand h2{margin:0;font-weight:800;letter-spacing:.6px}
.tag{color:#94a3b8;font-size:13px;margin-top:2px}
input,select,button{width:100%;padding:12px;margin-top:10px;border-radius:12px;border:none;box-sizing:border-box;background:#0b1220;color:white;outline:none}
input:focus{box-shadow:0 0 0 2px rgba(34,197,94,.35)}
button{background:linear-gradient(135deg,#22c55e,#16a34a);font-weight:700;cursor:pointer;transition:.2s}
button:hover{transform:translateY(-1px);box-shadow:0 10px 25px rgba(34,197,94,.35)}
/* --- APP --- */
#appArea{display:none;flex-direction:column;align-items:center;width:100%;overflow:auto}
header{position:sticky;top:0;background:#020617;color:white;padding:12px 14px;display:flex;justify-content:space-between;align-items:center;width:100%;z-index:999;box-shadow:0 10px 30px rgba(0,0,0,.5)}
.card{background:white;padding:16px;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.15);margin:15px;color:black;width:95%;max-width:1100px}
.grid-inputs{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:12px}
.page{background:white;width:210mm;min-height:297mm;margin:10px auto;padding:15mm;border:1px solid #ddd;color:black;box-sizing:border-box}
.report-header{text-align:center;margin-bottom:20px;line-height:1.35}
.multi-column{column-count:2;column-gap:40px;column-fill:auto;height:215mm}
.table-wrap{break-inside:avoid}
table{width:100%;border-collapse:collapse;margin-bottom:6px;border:2px solid #000}
th,td{border:1.5px solid #000;padding:6px 4px;text-align:center;font-size:14px}
th{background:#f3f4f6}
.summary{border:2px solid black;padding:12px;margin-top:10px;font-weight:700;display:flex;justify-content:space-between;font-size:16px}
.hidden{display:none!important}
@media print{header,.no-print,#loginLayer,#adminPanel,.btn-edit{display:none!important}body{background:white}.page{margin:0;border:none;width:100%;padding:10mm}@page{size:A4;margin:0}}
</style>
</head>
<body>

<div id="loginLayer">
  <div class="login-hero">
    <div class="login-glass">
      <div class="brand">
        <div class="logo">BF</div>
        <h2>BFIDC ERP</h2>
      </div>
      <div class="tag">Premium ‚Ä¢ Secure ‚Ä¢ Cloud Ready</div>
      <input id="uID" placeholder="User ID">
      <input id="uPass" type="password" placeholder="Password">
      <button id="loginBtn">Login Securely</button>
      <p style="color:#64748b;font-size:12px;margin-top:12px">Default: admin | 0000</p>
    </div>
  </div>
</div>

<div id="appArea">
<header>
    <div id="who"></div>
    <div style="font-weight:bold">üî• ULTRA GOD MODE ERP</div>
    <div style="display:flex;gap:10px">
        <button id="adminBtn" class="hidden" onclick="toggleAdmin()" style="background:#f59e0b;width:auto;padding:5px 12px">‚öôÔ∏è Users</button>
        <button onclick="backup()" style="background:#3b82f6;width:auto;padding:5px 12px">Backup</button>
        <button onclick="logout()" style="background:#ef4444;width:auto;padding:5px 12px">Logout</button>
    </div>
</header>

<div id="adminPanel" class="card no-print hidden">
    <h4>User Management</h4>
    <div class="grid-inputs">
        <input id="newU" placeholder="New ID">
        <input id="newP" placeholder="New Password">
        <button onclick="addUser()">Save/Reset User</button>
    </div>
</div>

<div class="card no-print">
    <div class="grid-inputs">
        <div>Tree No<input id="tree" value="1" oninput="updatePiece()" class="nav-item"></div>
        <div>Piece<input id="piece" readonly style="background:#e2e8f0"></div>
        <div>Type
            <select id="type" onchange="toggleInputs()" class="nav-item">
                <option value="log">Round Log</option>
                <option value="wood">Sawn Wood</option>
            </select>
        </div>
        <div><span id="labelV1">Girth (Inch)</span><input id="v1" class="nav-item"></div>
        <div id="thickBox" class="hidden">Thickness<input id="ve" class="nav-item"></div>
        <div>Length (Foot)<input id="v2" class="nav-item"></div>
    </div>
    <button id="addBtn" style="margin-top:15px; background:#22c55e">ADD DATA (+)</button>
    <div class="grid-inputs" style="margin-top:10px">
        <button onclick="exportExcel()" style="background:#16a34a">Excel Export</button>
        <button onclick="window.print()" style="background:#475569">Print A4 Report</button>
        <button onclick="clearAll()" style="background:#dc2626">Clear All Data</button>
    </div>
</div>

<div id="printArea"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
  databaseURL: "https://YOUR_PROJECT_ID.firebaseio.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT_ID.appspot.com",
  messagingSenderId: "1234567890",
  appId: "1:1234567890:web:abcdef123456"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let items = [];
let editIdx = null;

function handleLogin(){
    let id = uID.value.trim().toLowerCase();
    let ps = uPass.value.trim();
    let users = JSON.parse(localStorage.getItem("bfidc_users")) || {"admin":"0000"};
    if(users[id] && users[id] === ps){
        sessionStorage.setItem("active", id);
        start();
    } else alert("Invalid Login!");
}

function start(){
    loginLayer.style.display='none';
    appArea.style.display='flex';
    let user=sessionStorage.getItem("active");
    who.innerText="User: "+user.toUpperCase();
    if(user==='admin') adminBtn.classList.remove("hidden");
    updatePiece(); loadFromFirebase();
}

function logout(){ sessionStorage.clear(); location.reload(); }
function toggleAdmin(){ adminPanel.classList.toggle("hidden"); }
function addUser(){
    let id=newU.value.trim().toLowerCase();
    let ps=newP.value.trim();
    if(!id||!ps) return alert("Fill all fields");
    let users=JSON.parse(localStorage.getItem("bfidc_users"))||{"admin":"0000"};
    users[id]=ps;
    localStorage.setItem("bfidc_users",JSON.stringify(users));
    alert("User "+id+" Updated!");
    newU.value=''; newP.value='';
}

function toggleInputs(){
    let isWood=type.value==='wood';
    thickBox.classList.toggle("hidden",!isWood);
    labelV1.innerText=isWood?"Width (Inch)":"Girth (Inch)";
    render();
}

function updatePiece(){ piece.value=items.filter(i=>i.tree==tree.value).length+1; }

function addItem(){
    let t=tree.value, ty=type.value, v1v=parseFloat(v1.value), v2v=parseFloat(v2.value), vev=parseFloat(ve.value)||0;
    if(!v1v||!v2v) return;
    let cft = ty==='log'?((v1v/4)**2*v2v)/144:(v1v*vev*v2v)/144;
    let pNo = editIdx!==null?items[editIdx].piece:(items.filter(i=>i.tree==t).length+1);
    let data={tree:t,piece:pNo,type:ty,v1:v1v,v2:v2v,ve:vev,cft:+cft.toFixed(2)};
    if(editIdx!==null){ items[editIdx]=data; editIdx=null; addBtn.innerText="ADD DATA (+)"; }
    else items.push(data);
    v1.value=''; v2.value=''; ve.value=''; updatePiece(); saveToFirebase(); render();
}

function startEdit(idx){
    let i=items[idx]; editIdx=idx;
    tree.value=i.tree; type.value=i.type; v1.value=i.v1; v2.value=i.v2; ve.value=i.ve;
    addBtn.innerText="UPDATE DATA (‚úî)"; toggleInputs();
}

function render(){
    let ty=type.value;
    let filtered=items.filter(i=>i.type===ty);
    let total=0, treeSet=new Set();
    filtered.forEach(i=>{ total+=i.cft; treeSet.add(i.tree); });
    let header = ty==='log'?`<div class="report-header"><h3>BFIDC GOD MODE LOG</h3></div>`:`<div style="height:30px"></div>`;
    let html=`<div class="page">${header}<div class="multi-column"><table><tr><th>Tree/Pc</th><th>Size</th><th>CFT</th><th class="no-print">‚öô</th></tr>`;
    filtered.forEach(item=>{ let size=item.type==='log'?`${item.v1}"x${item.v2}'`:`${item.v1}"x${item.ve}"x${item.v2}'`; html+=`<tr><td>${item.tree}/${item.piece}</td><td>${size}</td><td>${item.cft}</td><td class="no-print"><button onclick="startEdit(${items.indexOf(item)})" style="padding:2px 5px;font-size:10px;width:auto;background:#3b82f6">Edit</button></td></tr>`});
    html+=`</table></div><div class="summary"><span>Trees: ${treeSet.size}</span><span>Pieces: ${filtered.length}</span><span>Total: ${total.toFixed(2)} CFT</span></div></div>`;
    printArea.innerHTML=html;
}

function exportExcel(){ let wb=XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb,XLSX.utils.json_to_sheet(items),"Data"); XLSX.writeFile(wb,"BFIDC_Report.xlsx"); }

function clearAll(){ if(confirm("Clear all data?")){ items=[]; localStorage.removeItem("bfidc_data"); render(); updatePiece(); saveToFirebase(); } }

function saveToFirebase(){ let user=sessionStorage.getItem("active")||"guest"; set(ref(db,'erp_data/'+user), items); }
function loadFromFirebase(){ let user=sessionStorage.getItem("active")||"guest"; const dataRef=ref(db,'erp_data/'+user); onValue(dataRef,(snapshot)=>{ items=snapshot.val()||[]; render(); updatePiece(); }); }

function backup(){ let blob=new Blob([JSON.stringify(localStorage)],{type:"application/json"}); let a=document.createElement("a"); a.href=URL.createObjectURL(blob); a.download="ULTRA_GOD_ERP_BACKUP.json"; a.click(); }

document.getElementById('loginBtn').addEventListener('click', handleLogin);

if(sessionStorage.getItem("active")) start();
</script>

</body>
</html>
