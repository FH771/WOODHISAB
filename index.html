<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>BFIDC ERP - TOTAL A4 FILL</title>
    <style>
        @font-face { font-family: 'Kalpurush'; src: url('https://cdn.jsdelivr.net/gh/at-shovo/bangla-fonts/Kalpurush/Kalpurush.ttf') format('truetype'); }
        body{font-family: 'Segoe UI', Arial, sans-serif; background:#0f172a; margin:0; color:white;}
        header{position:sticky; top:0; background:#020617; padding:10px; display:flex; justify-content:space-between; align-items:center; z-index:999; border-bottom: 1px solid #1e293b;}
        .card{background:white; padding:15px; border-radius:12px; margin:10px; color:black;}
        input, select { width:100%; padding:12px; border:1px solid #cbd5e1; border-radius:8px; box-sizing:border-box; font-size:16px; margin-bottom: 8px;}
        
        /* A4 FULL PAGE FILL LOGIC */
        .page { 
            background: white; 
            width: 210mm; 
            height: 297mm; /* ‡¶´‡¶ø‡¶ï‡ßç‡¶∏‡¶° ‡¶π‡¶æ‡¶á‡¶ü */
            margin: 10px auto; 
            padding: 10mm 15mm; 
            color: black; 
            box-sizing: border-box; 
            position: relative;
            display: flex;
            flex-direction: column;
            page-break-after: always;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        
        .report-header { text-align: center; margin-bottom: 10px; font-family: 'Kalpurush', sans-serif; }
        .report-header h3 { margin: 2px 0; font-size: 16px; line-height: 1.2; }
        
        /* ‡¶ï‡¶≤‡¶æ‡¶Æ ‡¶ó‡ßÅ‡¶≤‡ßã ‡¶Ø‡ßá‡¶® ‡¶™‡ßÅ‡¶∞‡ßã ‡¶ú‡¶æ‡ßü‡¶ó‡¶æ ‡¶®‡ßá‡ßü */
        .dual-container { 
            display: flex; 
            gap: 15px; 
            flex: 1; /* ‡¶™‡ßÅ‡¶∞‡ßã ‡¶ú‡¶æ‡ßü‡¶ó‡¶æ ‡¶¶‡¶ñ‡¶≤ ‡¶ï‡¶∞‡¶¨‡ßá */
            overflow: hidden;
        }
        .col { flex: 1; }
        
        table { width: 100%; border-collapse: collapse; border: 1.5px solid #000; }
        th, td { border: 1px solid #000; padding: 3px 2px; text-align: center; font-size: 12.5px; font-family: 'Kalpurush', sans-serif; }
        th { background: #eeeeee; font-weight: bold; }
        
        .summary-container { 
            position: absolute; 
            bottom: 10mm; 
            left: 15mm; 
            right: 15mm; 
            border-top: 2px solid #000;
            padding-top: 5px;
            font-family: 'Kalpurush', sans-serif;
        }
        
        .hidden { display:none!important; }
        .btn-del { background:#ef4444; color:white; border:none; padding:2px 5px; border-radius:3px; cursor:pointer; font-size: 10px; }

        @media print { 
            header, .no-print, #loginLayer {display:none!important} 
            body { background: white; margin: 0; } 
            .page { margin: 0; border: none; box-shadow: none; width: 100%; height: 297mm; } 
        }
    </style>
</head>
<body>

<div id="loginLayer" style="position:fixed; inset:0; background:#020617; display:flex; align-items:center; justify-content:center; z-index:9999">
    <div style="background:#111827; padding:25px; border-radius:14px; width:90%; max-width:320px; text-align:center">
        <h2 style="color:white; margin-bottom:20px">BFIDC LOGIN</h2>
        <input id="uID" placeholder="User ID">
        <input id="uPass" type="password" placeholder="Password">
        <button onclick="handleLogin()" style="width:100%; margin-top:10px; padding:12px; background:#22c55e; color:white; font-weight:bold; border:none; border-radius:8px; cursor:pointer">LOGIN</button>
    </div>
</div>

<div id="appArea" class="hidden">
    <header>
        <div id="who" style="font-size: 11px; color: #94a3b8; font-weight: bold;">BFIDC ADMIN</div>
        <div style="display:flex; gap:6px">
            <button onclick="downloadData()" style="background:#34a853; color:white; border:none; padding:8px 10px; border-radius:6px; font-size:11px; font-weight:bold;">üíæ SAVE</button>
            <button onclick="document.getElementById('fileInput').click()" style="background:#f59e0b; color:white; border:none; padding:8px 10px; border-radius:6px; font-size:11px; font-weight:bold;">üìÇ OPEN</button>
            <button onclick="newWork()" style="background:#6366f1; color:white; border:none; padding:8px 10px; border-radius:6px; font-size:11px; font-weight:bold;">‚ûï NEW</button>
            <input type="file" id="fileInput" class="hidden" accept=".json" onchange="uploadData(event)">
        </div>
    </header>
    
    <div class="card no-print">
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
            <div>‡¶ó‡¶æ‡¶õ ‡¶®‡¶Ç<input id="tree" value="1" oninput="updatePiece()" onkeydown="move(event, 'v1')"></div>
            <div>‡¶™‡¶ø‡¶∏ ‡¶®‡¶Ç<input id="piece" readonly style="background:#f1f5f9"></div>
        </div>
        <div>‡¶ß‡¶∞‡¶£
            <select id="type" onchange="toggleInputs(); updatePiece();">
                <option value="log">‡¶ó‡ßã‡¶≤ ‡¶ï‡¶æ‡¶† (Round Log)</option>
                <option value="wood">‡¶∏‡¶æ‡¶á‡¶ú ‡¶ï‡¶æ‡¶† (Sawn Wood)</option>
            </select>
        </div>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
            <div><span id="labelV1">‡¶¨‡ßá‡ßú (‡¶á‡¶û‡ßç‡¶ö‡¶ø)</span><input id="v1" inputmode="decimal" onkeydown="move(event, 'v2')"></div>
            <div id="thickBox" class="hidden">‡¶™‡ßÅ‡¶∞‡ßÅ‡¶§‡ßç‡¶¨<input id="ve" inputmode="decimal" onkeydown="move(event, 'v2')"></div>
            <div>‡¶≤‡¶Æ‡ßç‡¶¨‡¶æ (‡¶´‡ßÅ‡¶ü)<input id="v2" inputmode="decimal" onkeydown="move(event, 'save')"></div>
        </div>
        <button onclick="addItem()" id="addBtn" style="width:100%; background:#22c55e; color:white; padding:15px; font-size:18px; border:none; border-radius:8px; font-weight:bold;">‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶® (ENTER)</button>
        <button onclick="window.print()" style="width:100%; margin-top:8px; background:#475569; color:white; padding:10px; border:none; border-radius:8px; font-weight:bold;">PRINT / PDF</button>
    </div>
    <div id="printArea"></div>
</div>

<script>
    let items = JSON.parse(localStorage.getItem("bfidc_data")) || [];

    function handleLogin() { if(uID.value==="admin" && uPass.value==="0000") { sessionStorage.setItem("active", "admin"); start(); } else alert("Error!"); }
    function start() { loginLayer.classList.add("hidden"); appArea.classList.remove("hidden"); render(); updatePiece(); }
    function toggleInputs() { let isW = type.value==='wood'; thickBox.classList.toggle("hidden", !isW); labelV1.innerText = isW ? "‡¶ö‡¶ì‡ßú‡¶æ" : "‡¶¨‡ßá‡ßú"; render(); }
    function updatePiece() { let count = items.filter(i => i.tree == tree.value && i.type == type.value).length; piece.value = count + 1; }
    
    function move(e, next) { 
        if(e.key === "Enter") { e.preventDefault(); addItem(); } 
        if(e.key === "ArrowRight") { 
            e.preventDefault(); 
            if(e.target.id === 'tree') v1.focus(); 
            else if(next === 'v2' && type.value === 'wood' && e.target.id === 'v1') ve.focus(); 
            else if(next !== 'save') document.getElementById(next).focus(); 
        } 
    }

    function addItem() {
        let t = tree.value, ty = type.value, v1v = parseFloat(v1.value), v2v = parseFloat(v2.value), vev = parseFloat(ve.value) || 0;
        if(!v1v || !v2v) return;
        let cft = ty==='log' ? ((v1v/4)**2 * v2v)/144 : (v1v * vev * v2v)/144;
        items.push({tree: t, piece: items.filter(i=>i.tree==t && i.type==ty).length + 1, type: ty, v1: v1v, v2: v2v, ve: vev, cft: +cft.toFixed(2)});
        localStorage.setItem("bfidc_data", JSON.stringify(items));
        v1.value=""; v2.value=""; ve.value=""; render(); updatePiece(); 
        tree.focus(); tree.select(); 
    }

    function deleteItem(idx) { if(confirm("‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶¨‡ßá‡¶®?")) { items.splice(idx, 1); localStorage.setItem("bfidc_data", JSON.stringify(items)); render(); updatePiece(); } }

    function render() {
        let ty = type.value, filtered = items.filter(i => i.type === ty);
        let totalCft = filtered.reduce((s, i) => s + i.cft, 0), totalTrees = new Set(filtered.map(i => i.tree)).size;
        
        // ‡¶è‡¶¨‡¶æ‡¶∞ ‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶°‡¶æ‡¶á‡¶®‡¶æ‡¶Æ‡¶ø‡¶ï ‡¶≠‡¶æ‡¶¨‡ßá ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶¨‡ßã ‡¶ï‡¶§‡¶ó‡ßÅ‡¶≤‡ßã ‡¶∞‡ßã ‡¶ß‡¶∞‡¶≤‡ßá ‡¶™‡ßá‡¶ú ‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶π‡ßü
        // ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£‡¶§ ‡ßß‡ß®.‡ß´px ‡¶´‡¶®‡ßç‡¶ü ‡¶∏‡¶æ‡¶á‡¶ú‡ßá ‡ßß‡ßß‡ß™-‡ßß‡ß®‡ß¶‡¶ü‡¶ø ‡¶∞‡ßã ‡¶è‡¶ï ‡¶™‡ßá‡¶ú‡ßá ‡¶ß‡¶∞‡ßá (‡ß¨‡ß¶+‡ß¨‡ß¶)
        const ROWS_PER_PAGE = 114; 
        const HALF = 57; 
        let pagesHtml = "";
        let totalPages = Math.ceil(filtered.length / ROWS_PER_PAGE) || 1;

        for (let p = 0; p < totalPages; p++) {
            let pageData = filtered.slice(p * ROWS_PER_PAGE, (p + 1) * ROWS_PER_PAGE);
            let left = pageData.slice(0, HALF);
            let right = pageData.slice(HALF, ROWS_PER_PAGE);

            let tableH = `<tr><th>‡¶ó‡¶æ‡¶õ/‡¶™‡¶ø‡¶∏</th><th>‡¶Æ‡¶æ‡¶™</th><th>CFT</th><th class="no-print">‚öô</th></tr>`;

            pagesHtml += `
            <div class="page">
                <div class="report-header">
                    <h3>‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂ ‡¶¨‡¶® ‡¶∂‡¶ø‡¶≤‡ßç‡¶™ ‡¶â‡¶®‡ßç‡¶®‡ßü‡¶® ‡¶ï‡¶∞‡ßç‡¶™‡ßã‡¶∞‡ßá‡¶∂‡¶®, ..................... ‡¶∞‡¶æ‡¶¨‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶ó‡¶æ‡¶® ‡¶π‡¶§‡ßá ‡¶¨‡¶ø‡¶è‡¶´‡¶Ü‡¶á‡¶°‡¶ø‡¶∏‡¶ø, ‡¶è‡¶≤‡¶™‡¶ø‡¶∏‡¶ø</h3>
                    <h3>‡¶™‡ßç‡¶∞‡ßá‡¶∞‡¶£‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡¶∞‡ßç‡¶§‡¶®‡¶ï‡ßÉ‡¶§ ‡¶ú‡ßÄ‡¶¨‡¶®‡¶ö‡¶ï‡ßç‡¶∞ ‡¶π‡¶æ‡¶∞‡¶æ‡¶®‡ßã ‡¶∞‡¶æ‡¶¨‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶†‡ßá‡¶∞ ‡¶∏‡¶æ‡¶á‡¶ú ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü‡•§</h3>
                </div>
                <div class="dual-container">
                    <div class="col"><table>${tableH}${left.map(i => `<tr><td>${i.tree}/${i.piece}</td><td>${i.type==='log'?i.v1+'"x'+i.v2+"'":i.v1+'"x'+i.ve+'"x'+i.v2+"'"}</td><td>${i.cft}</td><td class="no-print"><button class="btn-del" onclick="deleteItem(${items.indexOf(i)})">D</button></td></tr>`).join('')}</table></div>
                    <div class="col"><table>${tableH}${right.map(i => `<tr><td>${i.tree}/${i.piece}</td><td>${i.type==='log'?i.v1+'"x'+i.v2+"'":i.v1+'"x'+i.ve+'"x'+i.v2+"'"}</td><td>${i.cft}</td><td class="no-print"><button class="btn-del" onclick="deleteItem(${items.indexOf(i)})">D</button></td></tr>`).join('')}</table></div>
                </div>`;
            
            if (p === totalPages - 1) {
                pagesHtml += `
                <div class="summary-container">
                    <div style="display:flex; justify-content:space-between; font-weight:bold; font-size:15px;">
                        <span>‡¶Æ‡ßã‡¶ü ‡¶ó‡¶æ‡¶õ: ${totalTrees} ‡¶ü‡¶ø, ‡¶Æ‡ßã‡¶ü ‡¶™‡¶ø‡¶∏: ${filtered.length} ‡¶ü‡¶ø, ‡¶Æ‡ßã‡¶ü ‡¶∏‡¶ø‡¶è‡¶´‡¶ü‡¶ø: ${totalCft.toFixed(2)}</span>
                        <span>‡¶™‡ßÉ‡¶∑‡ßç‡¶†‡¶æ: ${p+1} / ${totalPages}</span>
                    </div>
                </div>`;
            } else {
                pagesHtml += `<div class="summary-container" style="border:none; text-align:right; font-size:12px;">‡¶™‡ßÉ‡¶∑‡ßç‡¶†‡¶æ: ${p+1} / ${totalPages}</div>`;
            }
            pagesHtml += `</div>`;
        }
        document.getElementById("printArea").innerHTML = pagesHtml;
    }

    function downloadData() {
        const blob = new Blob([JSON.stringify(items)], {type: 'application/json'});
        const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = "BFIDC_Data.json"; a.click();
    }
    function uploadData(event) {
        const reader = new FileReader();
        reader.onload = function(e) { items = JSON.parse(e.target.result); localStorage.setItem("bfidc_data", JSON.stringify(items)); render(); updatePiece(); };
        reader.readAsText(event.target.files[0]);
    }
    function newWork() { if(confirm("‡¶∏‡¶¨ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá?")) { items = []; localStorage.removeItem("bfidc_data"); render(); updatePiece(); } }
    if(sessionStorage.getItem("active")) start();
</script>
</body>
</html>
