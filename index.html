<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BFIDC WOOD HISAB ELITE</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap');
        
        body { 
            margin:0; font-family: 'Poppins', sans-serif; 
            min-height: 100vh; display: flex; justify-content: center; align-items: flex-start;
            background: linear-gradient(rgba(0,0,0,0.8), rgba(0,0,0,0.8)), url('https://images.unsplash.com/photo-1542332213-9b5a5a3fad35?q=80&w=2070');
            background-size: cover; background-position: center; background-attachment: fixed;
            color: white; 
        }

        .container { width: 100%; max-width: 450px; padding: 20px; box-sizing: border-box; }

        .logo-container {
            width: 120px; height: 120px; margin: 20px auto;
            background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(15px);
            border-radius: 50%; display: flex; justify-content: center; align-items: center;
            border: 3px solid #00ffd5; box-shadow: 0 0 20px rgba(0, 255, 213, 0.5);
            overflow: hidden;
        }
        .logo-container img { width: 100%; height: 100%; object-fit: cover; }

        .glass-card {
            background: rgba(255, 255, 255, 0.08); backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 25px;
            padding: 30px; margin-bottom: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.6);
        }

        h2 { text-align: center; color: #00ffd5; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 2px; }
        
        input {
            width: 100%; padding: 14px; margin-top: 15px; border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.2); background: rgba(0,0,0,0.4);
            color: #fff; outline: none; box-sizing: border-box; font-size: 15px;
        }

        button {
            width: 100%; padding: 15px; margin-top: 25px; border-radius: 12px; border: none;
            background: linear-gradient(45deg, #00ffd5, #008cff); color: #000;
            font-weight: 700; cursor: pointer; transition: 0.3s;
        }
        button:hover { transform: scale(1.02); box-shadow: 0 0 15px rgba(0, 255, 213, 0.5); }

        #appArea, #adminPanel, #thickInput { display: none; }
        .error-msg { color: #ff8080; text-align: center; margin-top: 15px; font-weight: bold; }
        
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px; }
        .stat-box { background: rgba(255,255,255,0.1); padding: 15px 5px; border-radius: 15px; text-align: center; }
        .stat-box b { display: block; font-size: 18px; color: #00ffd5; }
    </style>
</head>
<body>

<div class="container">
    <div id="loginLayer">
        <div class="logo-container">
            <img src="Logo.jpg" alt="Logo" onerror="this.src='https://via.placeholder.com/150?text=LOGO'">
        </div>
        <div class="glass-card">
            <h2>BFIDC LOGIN</h2>
            <input type="email" id="emailInput" placeholder="Email (lpcfahad7@gmail.com)">
            <input type="password" id="passwordInput" placeholder="Password (547087)">
            <button onclick="handleAuth()">LOGIN NOW</button>
            <div id="msg" class="error-msg"></div>
        </div>
    </div>

    <div id="appArea">
        <div class="stats-grid">
            <div class="stat-box"><small>TREES</small><b id="treeStat">0</b></div>
            <div class="stat-box"><small>PIECES</small><b id="pieceStat">0</b></div>
            <div class="stat-box"><small>TOTAL CFT</small><b id="cftStat">0.00</b></div>
        </div>

        <div class="glass-card">
            <h3>Add Wood Data</h3>
            <select id="typeInput" onchange="toggleInputs()" style="width:100%; padding:12px; border-radius:10px; background:#000; color:#fff;">
                <option value="log">Round Log (গোল)</option>
                <option value="sawn">Sawn Wood (সাইজ)</option>
            </select>
            <input type="number" id="treeInput" placeholder="Tree No">
            <input type="number" id="pieceInput" placeholder="Piece No" readonly style="opacity:0.7">
            <input type="number" id="v1Input" placeholder="Girth / Width">
            <input type="number" id="thickInput" placeholder="Thickness">
            <input type="number" id="v2Input" placeholder="Length (ft)">
            <button onclick="addItem()">SAVE ENTRY</button>
        </div>

        <div class="glass-card"><canvas id="chart"></canvas></div>

        <div class="glass-card">
            <button onclick="backup()" style="background: #f1c40f;">Backup JSON</button>
            <button onclick="exportExcel()" style="background: #fff; margin-top:10px;">Export Excel</button>
            <button onclick="logout()" style="background: #ff4d4d; color: #fff; margin-top: 20px;">LOGOUT</button>
        </div>

        <div id="adminPanel" class="glass-card" style="border: 1px solid #00ffd5;">
            <h3>Admin Panel</h3>
            <input type="email" id="newUserEmail" placeholder="New Email">
            <input type="password" id="newUserPass" placeholder="New Pass">
            <button onclick="createUser()">ADD STAFF</button>
        </div>
    </div>
</div>

<script>
// ১. লগইন সহজ করার জন্য সরাসরি ভ্যালু চেক করা
function handleAuth() {
    const email = document.getElementById('emailInput').value.trim().toLowerCase();
    const pass = document.getElementById('passwordInput').value.trim();

    // সরাসরি চেক (যাতে ডাটাবেসের ঝামেলা না হয়)
    if (email === "lpcfahad7@gmail.com" && pass === "547087") {
        const user = { email, role: 'admin' };
        sessionStorage.setItem('loggedUser', JSON.stringify(user));
        startApp(user);
    } else {
        // এছাড়া অন্য কোনো সেভ করা স্টাফ থাকলে সেটা চেক করা
        let users = JSON.parse(localStorage.getItem('users') || '[]');
        let staff = users.find(u => u.email === email && u.pass === btoa(pass));
        if (staff) {
            sessionStorage.setItem('loggedUser', JSON.stringify(staff));
            startApp(staff);
        } else {
            document.getElementById('msg').innerText = "Wrong Email or Password!";
        }
    }
}

function startApp(user) {
    document.getElementById('loginLayer').style.display = 'none';
    document.getElementById('appArea').style.display = 'block';
    if(user.role === 'admin') document.getElementById('adminPanel').style.display = 'block';
    render(); drawChart();
}

function logout() { sessionStorage.clear(); location.reload(); }

// ২. ডাটা অপারেশন
let items = JSON.parse(localStorage.getItem('data') || '[]');

function toggleInputs() {
    document.getElementById('thickInput').style.display = (document.getElementById('typeInput').value === 'log') ? 'none' : 'block';
}

document.getElementById('treeInput').addEventListener('input', function() {
    document.getElementById('pieceInput').value = items.filter(i => i.tree == this.value).length + 1;
});

function addItem() {
    const tree = document.getElementById('treeInput').value;
    const v1 = +document.getElementById('v1Input').value;
    const len = +document.getElementById('v2Input').value;
    const type = document.getElementById('typeInput').value;
    const th = +document.getElementById('thickInput').value || 0;
    if(!tree || !v1 || !len) return;

    const cft = (type === 'log') ? ((v1/4)**2 * len)/144 : (v1 * th * len)/144;
    items.push({tree, piece: document.getElementById('pieceInput').value, cft: +cft.toFixed(2), type});
    localStorage.setItem('data', JSON.stringify(items));
    render(); drawChart();
    document.getElementById('pieceInput').value = items.filter(i => i.tree == tree).length + 1;
}

function render() {
    document.getElementById('treeStat').innerText = new Set(items.map(i => i.tree)).size;
    document.getElementById('pieceStat').innerText = items.length;
    document.getElementById('cftStat').innerText = items.reduce((s, i) => s + i.cft, 0).toFixed(2);
}

let chart;
function drawChart() {
    let map = {}; items.forEach(i => map[i.tree] = (map[i.tree] || 0) + i.cft);
    const ctx = document.getElementById('chart').getContext('2d');
    if(chart) chart.destroy();
    chart = new Chart(ctx, {
        type: 'bar',
        data: { labels: Object.keys(map), datasets: [{ label: 'CFT', data: Object.values(map), backgroundColor: '#00ffd5' }] }
    });
}

function createUser() {
    let users = JSON.parse(localStorage.getItem('users') || '[]');
    let e = document.getElementById('newUserEmail').value.toLowerCase().trim();
    let p = document.getElementById('newUserPass').value.trim();
    if(e && p) {
        users.push({email: e, pass: btoa(p), role: 'staff'});
        localStorage.setItem('users', JSON.stringify(users));
        alert("Staff Added!");
    }
}

function backup() {
    let a = document.createElement('a');
    a.href = URL.createObjectURL(new Blob([JSON.stringify(items)], {type:'application/json'}));
    a.download = 'BFIDC_DATA.json'; a.click();
}

function exportExcel() {
    let ws = XLSX.utils.json_to_sheet(items);
    let wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "Data");
    XLSX.writeFile(wb, "BFIDC_Wood.xlsx");
}

window.onload = () => {
    // আগের ভুল ইউজার ডাটা ক্লিয়ার করা (প্রথমবার রান করার জন্য)
    if (!localStorage.getItem('fixed_v1')) {
        localStorage.removeItem('users');
        localStorage.setItem('fixed_v1', 'true');
    }
    
    let saved = sessionStorage.getItem('loggedUser');
    if(saved) startApp(JSON.parse(saved));
};
</script>
</body>
</html>
