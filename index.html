<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REPORT TO WORD</title>
    <style>
        @font-face { font-family: 'Kalpurush'; src: url('https://cdn.jsdelivr.net/gh/at-shovo/bangla-fonts/Kalpurush/Kalpurush.ttf') format('truetype'); }
        body{font-family: 'Segoe UI', Arial, sans-serif; background:#0f172a; margin:0; color:white;}
        header{position:sticky; top:0; background:#020617; padding:10px; display:flex; justify-content:space-between; align-items:center; z-index:999; border-bottom: 1px solid #1e293b;}
        .card{background:white; padding:15px; border-radius:12px; margin:10px; color:black;}
        input, select { width:100%; padding:10px; border:1px solid #cbd5e1; border-radius:8px; box-sizing:border-box; font-size:16px; margin-bottom: 8px;}
        
        /* Report Style */
        .page { background: white; width: 210mm; margin: 0 auto; padding: 10mm; color: black; font-family: 'Kalpurush', sans-serif; position: relative; page-break-after: always;}
        .report-header { text-align: center; margin-bottom: 10px; }
        .report-header h3 { margin: 2px 0; font-size: 16px; }
        
        .content-wrapper { display: flex; gap: 15px; }
        .col { flex: 1; }
        
        table { width: 100%; border-collapse: collapse; border: 1.5px solid #000; }
        th, td { border: 1px solid #000; padding: 3px; text-align: center; font-size: 12px; }
        
        .summary-box { width: 250px; margin-top: 15px; border: 1.8px solid #000; }
        .summary-box div { display: flex; border-bottom: 1.2px solid #000; }
        .summary-box span { padding: 5px; font-weight: bold; font-size: 14px; }
        .summary-box .label { border-right: 1.8px solid #000; flex: 1.4; background: #f2f2f2; }
        .summary-box .val { flex: 1; text-align: center; }

        .hidden { display:none!important; }
        @media print { header, .no-print, #loginLayer {display:none!important} .page {margin:0; width:100%;} }
    </style>
</head>
<body>

<div id="loginLayer" style="position:fixed; inset:0; background:#020617; display:flex; align-items:center; justify-content:center; z-index:9999">
    <div style="background:#111827; padding:25px; border-radius:14px; width:90%; max-width:320px; text-align:center">
        <h2 style="color:white; margin-bottom:20px">BFIDC LOGIN</h2>
        <input id="uID" placeholder="User ID">
        <input id="uPass" type="password" placeholder="Password">
        <button onclick="handleLogin()" style="width:100%; margin-top:10px; padding:12px; background:#22c55e; color:white; font-weight:bold; border:none; border-radius:8px;">LOGIN</button>
    </div>
</div>

<div id="appArea" class="hidden">
    <header>
        <div style="font-size: 11px; color: #94a3b8;">BFIDC ADMIN</div>
        <div style="display:flex; gap:6px">
            <button onclick="exportToWord()" style="background:#2b5797; color:white; border:none; padding:8px 10px; border-radius:6px; font-size:11px;">üìÑ WORD FILE</button>
            <button onclick="downloadData()" style="background:#34a853; color:white; border:none; padding:8px 10px; border-radius:6px; font-size:11px;">üíæ SAVE DATA</button>
            <button onclick="window.print()" style="background:#475569; color:white; border:none; padding:8px 10px; border-radius:6px; font-size:11px;">üñ®Ô∏è PRINT</button>
        </div>
    </header>
    
    <div class="card no-print">
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
            <div>‡¶ó‡¶æ‡¶õ ‡¶®‡¶Ç<input id="tree" value="1" onkeydown="move(event, 'v1')"></div>
            <div>‡¶≤‡¶Æ‡ßç‡¶¨‡¶æ (‡¶´‡ßÅ‡¶ü)<input id="v2" inputmode="decimal" onkeydown="move(event, 'save')"></div>
        </div>
        <div>‡¶¨‡ßá‡ßú (‡¶á‡¶û‡ßç‡¶ö‡¶ø)<input id="v1" inputmode="decimal" onkeydown="move(event, 'v2')"></div>
        <button onclick="addItem()" id="addBtn" style="width:100%; background:#22c55e; color:white; padding:12px; font-size:18px; border:none; border-radius:8px; font-weight:bold;">‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    </div>
    
    <div id="printArea"></div>
</div>

<script>
    let items = JSON.parse(localStorage.getItem("bfidc_data")) || [];

    function handleLogin() { if(uID.value==="admin" && uPass.value==="0000") { sessionStorage.setItem("active", "admin"); start(); } else alert("Error!"); }
    function start() { loginLayer.classList.add("hidden"); appArea.classList.remove("hidden"); render(); }
    function move(e, next) { if(e.key === "Enter") { e.preventDefault(); if(next==='save') addItem(); else document.getElementById(next).focus(); } }

    function addItem() {
        let t = tree.value, v1v = parseFloat(v1.value), v2v = parseFloat(v2.value);
        if(!v1v || !v2v) return;
        let cft = ((v1v/4)**2 * v2v)/144;
        items.push({tree: t, piece: items.filter(i=>i.tree==t).length + 1, v1: v1v, v2: v2v, cft: +cft.toFixed(2)});
        localStorage.setItem("bfidc_data", JSON.stringify(items));
        v1.value=""; v2.value=""; render(); tree.focus(); tree.select();
    }

    function render() {
        let totalCft = items.reduce((s, i) => s + i.cft, 0);
        let totalTrees = new Set(items.map(i => i.tree)).size;
        
        let html = `<div class="page" id="wordContent">
            <div class="report-header">
                <h3>‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂ ‡¶¨‡¶® ‡¶∂‡¶ø‡¶≤‡ßç‡¶™ ‡¶â‡¶®‡ßç‡¶®‡ßü‡¶® ‡¶ï‡¶∞‡ßç‡¶™‡ßã‡¶∞‡ßá‡¶∂‡¶®</h3>
                <h3>‡¶∞‡¶æ‡¶¨‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶ó‡¶æ‡¶® ‡¶π‡¶§‡ßá ‡¶¨‡¶ø‡¶è‡¶´‡¶Ü‡¶á‡¶°‡¶ø‡¶∏‡¶ø, ‡¶è‡¶≤‡¶™‡¶ø‡¶∏‡¶ø ‡¶™‡ßç‡¶∞‡ßá‡¶∞‡¶£‡ßá‡¶∞ ‡¶∏‡¶æ‡¶á‡¶ú ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü</h3>
            </div>
            <div class="content-wrapper">
                <div class="col"><table id="tableL"><tr><th>‡¶ó‡¶æ‡¶õ/‡¶™‡¶ø‡¶∏</th><th>‡¶Æ‡¶æ‡¶™</th><th>CFT</th></tr>`;
        
        let mid = Math.ceil(items.length / 2);
        items.forEach((item, idx) => {
            let row = `<tr><td>${item.tree}/${item.piece}</td><td>${item.v1}"x${item.v2}'</td><td>${item.cft}</td></tr>`;
            if(idx < mid) html += row;
            if(idx === mid) html += `</table></div><div class="col"><table><tr><th>‡¶ó‡¶æ‡¶õ/‡¶™‡¶ø‡¶∏</th><th>‡¶Æ‡¶æ‡¶™</th><th>CFT</th></tr>` + row;
            if(idx > mid) html += row;
        });

        html += `</table></div></div>
            <div class="summary-box">
                <div><span class="label">‡¶Æ‡ßã‡¶ü ‡¶ó‡¶æ‡¶õ:</span><span class="val">${totalTrees} ‡¶ü‡¶ø</span></div>
                <div><span class="label">‡¶Æ‡ßã‡¶ü ‡¶™‡¶ø‡¶∏:</span><span class="val">${items.length} ‡¶ü‡¶ø</span></div>
                <div><span class="label">‡¶Æ‡ßã‡¶ü ‡¶∏‡¶ø‡¶è‡¶´‡¶ü‡¶ø:</span><span class="val">${totalCft.toFixed(2)}</span></div>
            </div>
        </div>`;
        document.getElementById("printArea").innerHTML = html;
    }

    function exportToWord() {
        let content = document.getElementById("wordContent").innerHTML;
        let header = "<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'><head><meta charset='utf-8'><title>Export HTML to Word</title><style>table {border-collapse:collapse; width:100%;} td, th {border:1px solid black; padding:5px; text-align:center; font-family: 'Kalpurush';}</style></head><body>";
        let footer = "</body></html>";
        let sourceHTML = header + content + footer;
        
        let source = 'data:application/vnd.ms-word;charset=utf-8,' + encodeURIComponent(sourceHTML);
        let fileDownload = document.createElement("a");
        document.body.appendChild(fileDownload);
        fileDownload.href = source;
        fileDownload.download = 'BFIDC_Report.doc';
        fileDownload.click();
        document.body.removeChild(fileDownload);
    }

    function downloadData() {
        const blob = new Blob([JSON.stringify(items)], {type: 'application/json'});
        const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = "BFIDC_Data.json"; a.click();
    }
    if(sessionStorage.getItem("active")) start();
</script>
</body>
</html>
