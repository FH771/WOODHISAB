<!DOCTYPE html><html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BFIDCWOODHISAB TITANIUM</title><style>
:root{
--primary:#22c55e;
--dark:#020617;
--card:#0f172a;
}

body{
margin:0;
font-family:'Segoe UI',sans-serif;
background:linear-gradient(135deg,#020617,#0f172a);
color:white;
}

/* LOGIN */
#loginLayer{
position:fixed;
inset:0;
display:flex;
align-items:center;
justify-content:center;
background:radial-gradient(circle,#0f172a,#020617);
}

.login-box{
background:rgba(15,23,42,.9);
padding:40px;
border-radius:20px;
width:340px;
box-shadow:0 25px 60px rgba(0,0,0,.6);
text-align:center;
border:1px solid #22c55e55;
}

input,select,button{
width:100%;
padding:12px;
margin-top:10px;
border-radius:10px;
border:none;
font-size:16px;
}

input{background:#020617;color:white;border:1px solid #334155}

button{
background:var(--primary);
color:white;
font-weight:bold;
cursor:pointer;
transition:.2s;
}

button:hover{transform:scale(1.03)}

/* APP */
#appArea{display:none}

header{
display:flex;
justify-content:space-between;
align-items:center;
padding:15px 25px;
background:#020617;
border-bottom:1px solid #22c55e33;
position:sticky;
top:0;
z-index:999;
}

.logo{
font-size:22px;
font-weight:900;
color:var(--primary);
letter-spacing:1px;
}

.dashboard{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
gap:15px;
padding:20px;
}

.stat{
background:rgba(15,23,42,.8);
padding:20px;
border-radius:18px;
text-align:center;
box-shadow:0 10px 25px rgba(0,0,0,.5);
}

.stat h2{margin:0;color:#22c55e}

.card{
margin:20px;
padding:20px;
border-radius:20px;
background:var(--card);
box-shadow:0 10px 30px rgba(0,0,0,.6);
}

.grid{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(150px,1fr));
gap:12px;
}

.table-wrap{overflow:auto}

table{
width:100%;
border-collapse:collapse;
margin-top:15px;
}

th,td{
padding:8px;
border-bottom:1px solid #334155;
text-align:center;
}

th{background:#020617}

.action-btn{
padding:4px 8px;
border-radius:6px;
font-size:12px;
width:auto;
}

.edit{background:#3b82f6}
.delete{background:#ef4444}

.search{
margin-top:10px;
background:#020617;
border:1px solid #334155;
}

.quick-bar{
display:flex;
gap:10px;
flex-wrap:wrap;
}

.quick-bar button{width:auto;padding:8px 14px}

@media print{
header,.no-print,.dashboard,.quick-bar{display:none}
body{background:white}
.card{box-shadow:none}
}

</style></head>
<body><div id="loginLayer">
<div class="login-box">
<h2>BFIDCWOODHISAB</h2>
<p>TITANIUM Forestry System</p>
<input id="pass" type="password" placeholder="Enter Password" onkeydown="if(event.key==='Enter')handleLogin()">
<button onclick="handleLogin()">LOGIN</button>
</div>
</div><div id="appArea">
<header>
<div class="logo">BFIDCWOODHISAB</div>
<div class="quick-bar">
<button onclick="exportExcel()">Excel</button>
<button onclick="backup()">Backup</button>
<button onclick="window.print()">Print</button>
<button onclick="logout()" style="background:#ef4444">Logout</button>
</div>
</header><div class="dashboard">
<div class="stat"><h2 id="treeStat">0</h2>Trees</div>
<div class="stat"><h2 id="pieceStat">0</h2>Pieces</div>
<div class="stat"><h2 id="cftStat">0</h2>Total CFT</div>
</div><div class="card no-print">
<div class="grid">
<div>Tree<input id="tree" type="number" value="1" oninput="updatePiece()"></div>
<div>Piece<input id="piece" readonly></div>
<div>Type
<select id="type" onchange="toggleInputs();render()">
<option value="log">Round Log</option>
<option value="wood">Sawn Wood</option>
</select>
</div>
<div id="girthBox">Girth<input id="v1" type="number"></div>
<div id="thickBox" style="display:none">Thickness<input id="thick" type="number"></div>
<div>Length<input id="v2" type="number"></div>
</div>
<button onclick="addItem()">SAVE</button>
<input class="search" id="search" placeholder="Search Tree..." oninput="render()">
</div><div class="card table-wrap">
<div id="tableArea"></div>
</div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script><script>
let items=JSON.parse(localStorage.getItem('bfidc_data')||'[]');
let editIndex=null;

function handleLogin(){
if(pass.value==='0000'){
loginLayer.style.display='none';
appArea.style.display='block';
render();
updatePiece();
}else alert('Wrong Password');
}

function logout(){location.reload()}

function toggleInputs(){
let isWood=type.value==='wood';
thickBox.style.display=isWood?'block':'none';
girthBox.style.display=isWood?'none':'block';
}

function updatePiece(){
piece.value=items.filter(i=>i.tree==tree.value).length+1;
}

function addItem(){
let t=parseInt(tree.value);
let v2v=parseFloat(v2.value);
let cft,v1v,th;

if(type.value==='log'){
v1v=parseFloat(v1.value);
if(!t||!v1v||!v2v)return;
cft=((v1v/4)**2*v2v)/144;
}else{
v1v=parseFloat(v1.value);
th=parseFloat(thick.value);
if(!t||!v1v||!th||!v2v)return;
cft=(v1v*th*v2v)/144;
}

let obj={tree:t,piece:editIndex!==null?items[editIndex].piece:items.filter(i=>i.tree==t).length+1,type:type.value,v1:v1v,v2:v2v,thick:th||0,cft:+cft.toFixed(2)};

if(editIndex!==null){
items[editIndex]=obj;
editIndex=null;
}else items.push(obj);

localStorage.setItem('bfidc_data',JSON.stringify(items));

v1.value=v2.value=thick.value='';
render();updatePiece();
}

function editItem(i){
let d=items[i];
editIndex=i;
tree.value=d.tree;
type.value=d.type;
toggleInputs();
v1.value=d.v1;
v2.value=d.v2;
thick.value=d.thick;
window.scrollTo({top:0,behavior:'smooth'});
}

function deleteItem(i){
if(confirm('Delete item?')){
items.splice(i,1);
localStorage.setItem('bfidc_data',JSON.stringify(items));
render();updatePiece();
}
}

function render(){
let keyword=search.value?.toLowerCase()||'';
let filtered=items.filter(i=>i.tree.toString().includes(keyword));

let trees=new Set(filtered.map(i=>i.tree)).size;
let total=filtered.reduce((s,i)=>s+i.cft,0);

treeStat.innerText=trees;
pieceStat.innerText=filtered.length;
cftStat.innerText=total.toFixed(2);

let html='<table><tr><th>Tree/Piece</th><th>Size</th><th>CFT</th><th class="no-print">Action</th></tr>';

filtered.forEach((d)=>{
let idx=items.indexOf(d);
let size=d.type==='log'?`${d.v1}" x ${d.v2}'`:`${d.v1}" x ${d.thick}" x ${d.v2}'`;
html+=`<tr>
<td>${d.tree}/${d.piece}</td>
<td>${size}</td>
<td>${d.cft}</td>
<td class='no-print'>
<button class='action-btn edit' onclick='editItem(${idx})'>Edit</button>
<button class='action-btn delete' onclick='deleteItem(${idx})'>Delete</button>
</td>
</tr>`;
});

html+='</table>';

tableArea.innerHTML=html;
}

function backup(){
let blob=new Blob([JSON.stringify(items)],{type:'application/json'});
let a=document.createElement('a');
a.href=URL.createObjectURL(blob);
a.download='BFIDCWOODHISAB_Backup.json';
a.click();
}

function exportExcel(){
let wb=XLSX.utils.book_new();
let ws=XLSX.utils.json_to_sheet(items);
XLSX.utils.book_append_sheet(wb,ws,'Data');
XLSX.writeFile(wb,'BFIDCWOODHISAB.xlsx');
}

if(sessionStorage.getItem('active'))handleLogin();
</script></body>
</html>
