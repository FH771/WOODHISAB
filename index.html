<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BFIDC Wood Manager PRO</title>

<!-- Libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{
    font-family:Segoe UI;
    margin:0;
    background:#eef2f7;
}

header{
    position:sticky;
    top:0;
    background:#1b5e20;
    color:white;
    padding:12px;
    font-size:20px;
    text-align:center;
    z-index:999;
}

.container{
    max-width:1100px;
    margin:auto;
    padding:10px;
}

.card{
    background:white;
    padding:12px;
    border-radius:12px;
    box-shadow:0 3px 10px rgba(0,0,0,.1);
    margin-bottom:10px;
}

.grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(120px,1fr));
    gap:8px;
}

input,select,button{
    padding:10px;
    border-radius:8px;
    border:1px solid #ccc;
    font-size:14px;
}

button{
    background:#2e7d32;
    color:white;
    border:none;
    cursor:pointer;
}

button:hover{
    opacity:.9;
}

table{
    width:100%;
    border-collapse:collapse;
}

th,td{
    border:1px solid #ddd;
    padding:6px;
    text-align:center;
}

.summary{
    font-weight:bold;
    padding:10px;
    background:#e8f5e9;
    border-radius:8px;
}

.dark{
    background:#121212;
    color:white;
}

.dark .card{background:#1e1e1e}
.dark input,.dark select{background:#2c2c2c;color:white;border:none}

</style>
</head>
<body>

<header>
BFIDC Wood Manager PRO üå≤
<button onclick="toggleDark()" style="float:right">üåô</button>
</header>

<div class="container">

<div class="card grid">
<input id="tree" placeholder="Tree No">
<input id="piece" placeholder="Piece" readonly>
<select id="type">
<option value="log">Log</option>
<option value="wood">Wood</option>
</select>
<input id="v1" placeholder="Width / Round">
<input id="v2" placeholder="Length">
<input id="ve" placeholder="Thickness (wood only)">
<button onclick="addItem()">Add</button>
</div>

<div class="card grid">
<input id="search" placeholder="üîé Search" oninput="render()">
<button onclick="exportExcel()">Excel</button>
<button onclick="exportPDF()">PDF</button>
<button onclick="clearAll()" style="background:#c62828">Clear</button>
</div>

<div class="card">
<table>
<thead>
<tr>
<th>Tree/Piece</th>
<th>Type</th>
<th>Size</th>
<th>CFT</th>
<th>‚ùå</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>
</div>

<div class="summary" id="summary"></div>

</div>

<script>

let items = JSON.parse(localStorage.getItem("wood_pro")) || [];

function save(){
    localStorage.setItem("wood_pro",JSON.stringify(items));
}

function autoPiece(tree){
    let filtered = items.filter(i=>i.tree==tree);
    return filtered.length+1;
}

function addItem(){
    let tree=document.getElementById("tree").value;
    let type=document.getElementById("type").value;
    let v1=parseFloat(v1El().value);
    let v2=parseFloat(v2El().value);
    let ve=parseFloat(veEl().value)||0;

    if(!tree||!v1||!v2) return alert("Missing data");

    let piece=autoPiece(tree);

    let cft = type==="log"
        ? ((v1/4)**2*v2)/144
        : (v1*ve*v2)/144;

    items.push({tree,piece,type,v1,v2,ve,cft:+cft.toFixed(2)});

    save();
    render();

    document.getElementById("piece").value=autoPiece(tree);
    v1El().value="";
    v2El().value="";
    veEl().value="";
}

function v1El(){return document.getElementById("v1")}
function v2El(){return document.getElementById("v2")}
function veEl(){return document.getElementById("ve")}

function render(){

let search=document.getElementById("search").value.toLowerCase();
let tbody=document.getElementById("tbody");

tbody.innerHTML="";

let total=0;
let trees=new Set();

items
.filter(i=>JSON.stringify(i).toLowerCase().includes(search))
.forEach((i,idx)=>{

let size=i.type=="log"
? `${i.v1}" x ${i.v2}'`
: `${i.v1}" x ${i.ve}" x ${i.v2}'`;

let tr=`
<tr>
<td>${i.tree}/${i.piece}</td>
<td>${i.type}</td>
<td>${size}</td>
<td>${i.cft}</td>
<td><button onclick="del(${idx})">X</button></td>
</tr>`;

tbody.innerHTML+=tr;

total+=i.cft;
trees.add(i.tree);
});

summary.innerText=`Trees: ${trees.size} | Pieces: ${items.length} | Total CFT: ${total.toFixed(2)}`;
}

function del(i){
if(confirm("Delete?") ){
items.splice(i,1);
save();
render();
}
}

function clearAll(){
if(confirm("Clear all data?")){
items=[];
save();
render();
}
}

function toggleDark(){
document.body.classList.toggle("dark");
}

function exportExcel(){
let ws=XLSX.utils.json_to_sheet(items);
let wb=XLSX.utils.book_new();
XLSX.utils.book_append_sheet(wb,ws,"Wood");
XLSX.writeFile(wb,"wood_report.xlsx");
}

async function exportPDF(){
const {jsPDF}=window.jspdf;
let doc=new jsPDF();
let y=10;

items.forEach(i=>{
doc.text(`${i.tree}/${i.piece} | ${i.cft} CFT`,10,y);
y+=8;
});

doc.save("wood.pdf");
}

render();
</script>

</body>
</html>
