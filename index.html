<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
<title>BFIDCWOODHISAB TITANIUM PRO</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
:root{ --primary:#22c55e; --dark:#020617; --card:#0f172a; }
@font-face { font-family: 'Kalpurush'; src: url('https://cdn.jsdelivr.net/gh/at-shovo/bangla-fonts/Kalpurush/Kalpurush.ttf') format('truetype'); }

body{ margin:0; font-family:'Segoe UI',sans-serif; background:linear-gradient(135deg,#020617,#0f172a); color:white; -webkit-print-color-adjust: exact; }

/* LOGIN */
#loginLayer{ position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:radial-gradient(circle,#0f172a,#020617); z-index: 10000;}
.login-box{ background:rgba(15,23,42,.9); padding:40px; border-radius:20px; width:340px; box-shadow:0 25px 60px rgba(0,0,0,.6); text-align:center; border:1px solid #22c55e55; }

input,select,button{ width:100%; padding:12px; margin-top:10px; border-radius:10px; border:none; font-size:16px; box-sizing: border-box; }
input{background:#020617;color:white;border:1px solid #334155}
input:focus{outline: 2px solid var(--primary); background: #0f172a;}
button{ background:var(--primary); color:white; font-weight:bold; cursor:pointer; transition:.2s; }
button:hover{transform:scale(1.03)}

/* APP AREA */
#appArea{display:none}
header{ display:flex; justify-content:space-between; align-items:center; padding:10px 15px; background:#020617; border-bottom:1px solid #22c55e33; position:sticky; top:0; z-index:999; flex-wrap: wrap; gap: 10px; }
.logo-area{ display:flex; align-items:center; gap:8px; }
.header-logo{ height: 30px; width: 30px; border-radius: 5px; border: 1px solid var(--primary); }
.logo{ font-size:16px; font-weight:900; color:var(--primary); letter-spacing:1px; }

.btn-group { display:flex; gap:5px; flex-wrap: wrap; }
.action-btn{ padding:6px 10px; border-radius:6px; font-size:11px; width:auto; color: white; border: none; cursor: pointer; background: #334155; }

.top-search-container { padding: 10px 20px; }
.search-input { background: #0f172a; border: 1px solid #334155; color: white; padding: 10px; border-radius: 8px; font-size: 14px; }

.dashboard{ display:grid; grid-template-columns:repeat(auto-fit,minmax(120px,1fr)); gap:10px; padding:0 20px; }
.stat{ background:rgba(15,23,42,.8); padding:10px; border-radius:15px; text-align:center; border-bottom: 2px solid var(--primary); }
.stat h2{margin:0;color:#22c55e; font-size: 20px;}

.card{ margin:15px 20px; padding:15px; border-radius:20px; background:var(--card); border: 1px solid #334155; }
.grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(120px,1fr)); gap:10px; }

/* REPORT */
.report-page { background: white; color: black; width: 210mm; min-height: 296mm; margin: 20px auto; padding: 10mm 15mm; position: relative; page-break-after: always; box-sizing: border-box; }
.watermark { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 70%; opacity: 0.08; z-index: 0; pointer-events: none; }
table{ width:100%; border-collapse:collapse; margin-top:10px; font-family: 'Kalpurush', sans-serif; }
th,td{ padding:4px; border:1px solid #000; text-align:center; font-size: 12px;}
th{background:#f2f2f2 !important;}

@media print{ header, .no-print, .dashboard, .card, #loginLayer {display:none !important} body{background:white; margin:0;} .report-page {margin:0; border:none; display:block !important;} }
</style>
</head>
<body>

<div id="loginLayer">
    <div class="login-box">
        <h2 style="color:var(--primary)">BFIDCWOODHISAB</h2>
        <input id="passInput" type="password" placeholder="Password" onkeydown="if(event.key==='Enter') handleLogin()">
        <button onclick="handleLogin()">LOGIN</button>
    </div>
</div>

<div id="appArea">
    <header>
        <div class="logo-area">
            <img src="logo.jpg" class="header-logo" alt="L">
            <div class="logo">BFIDCWOODHISAB</div>
        </div>
        <div class="btn-group">
            <button class="action-btn" onclick="document.getElementById('importFile').click()">Upload</button>
            <input type="file" id="importFile" style="display:none" onchange="importData(event)">
            <button class="action-btn" onclick="changePass()">Change</button>
            <button class="action-btn" onclick="exportExcel()" style="background:#10b981">Excel</button>
            <button class="action-btn" onclick="exportWord()" style="background:#3b82f6">Word</button>
            <button class="action-btn" onclick="backup()" style="background:var(--primary)">Save</button>
        </div>
    </header>

    <div class="top-search-container no-print">
        <input id="searchInput" class="search-input" placeholder="Search Tree No..." oninput="render()">
    </div>

    <div class="dashboard no-print">
        <div class="stat"><h2><span id="treeStat">0</span></h2><p style="margin:0; font-size:11px">Trees</p></div>
        <div class="stat"><h2><span id="pieceStat">0</span></h2><p style="margin:0; font-size:11px">Pieces</p></div>
        <div class="stat"><h2><span id="cftStat">0.00</span></h2><p style="margin:0; font-size:11px">Total CFT</p></div>
    </div>

    <div class="card no-print">
        <div class="grid">
            <div>‡¶ó‡¶æ‡¶õ ‡¶®‡¶Ç<input id="treeInput" type="number" value="1" oninput="updatePiece()"></div>
            <div>‡¶ü‡¶æ‡¶á‡¶™
                <select id="typeInput" onchange="toggleInputs()">
                    <option value="log">Round Log</option>
                    <option value="size">Sawn Wood</option>
                </select>
            </div>
            <div>‡¶™‡¶ø‡¶∏ ‡¶®‡¶Ç<input id="pieceInput" readonly style="opacity:0.6"></div>
        </div>
        <div class="grid" style="margin-top:10px">
            <div id="girthBox">‡¶¨‡ßá‡ßú (‡¶á‡¶û‡ßç‡¶ö‡¶ø)<input id="v1Input" type="number" step="any"></div>
            <div id="thickBox" style="display:none">
                <div style="display:flex; gap:5px">
                    <div style="flex:1">‡¶ö‡¶ì‡ßú‡¶æ<input id="widthInput" type="number" step="any"></div>
                    <div style="flex:1">‡¶™‡ßÅ‡¶∞‡ßÅ‡¶§‡ßç‡¶¨<input id="thickInput" type="number" step="any"></div>
                </div>
            </div>
            <div>‡¶≤‡¶Æ‡ßç‡¶¨‡¶æ (‡¶´‡ßÅ‡¶ü)<input id="v2Input" type="number" step="any"></div>
            <div style="display:flex; align-items:flex-end">
                <button id="saveBtn" onclick="addItem()" style="height:45px">SAVE (ENTER)</button>
            </div>
        </div>
    </div>

    <div id="printArea"></div>
</div>

<script>
let items = JSON.parse(localStorage.getItem('bfidc_data') || '[]');
let editIndex = null;
const logoFile = "logo.jpg";

// üéØ Keyboard Nav
document.addEventListener('keydown', (e) => {
    const active = document.activeElement;
    if (e.key === 'ArrowRight') {
        if (active.id === 'treeInput') (typeInput.value === 'log' ? v1Input : widthInput).focus();
        else if (active.id === 'v1Input' || active.id === 'thickInput') v2Input.focus();
    }
    if (e.key === 'Enter' && active.id === 'v2Input') addItem();
});

function handleLogin(){
    let savedPass = localStorage.getItem('bfidc_pass') || '0000';
    if(passInput.value === savedPass){ loginLayer.style.display = 'none'; appArea.style.display = 'block'; render(); updatePiece(); } 
    else alert('Wrong Password');
}

function changePass(){
    let newP = prompt("Enter New Password:");
    if(newP) { localStorage.setItem('bfidc_pass', newP); alert("Password Changed!"); }
}

function toggleInputs(){
    let isSize = typeInput.value === 'size';
    thickBox.style.display = isSize ? 'block' : 'none';
    girthBox.style.display = isSize ? 'none' : 'block';
}

function updatePiece(){ pieceInput.value = items.filter(i => i.tree == treeInput.value && i.type === typeInput.value).length + 1; }

function addItem(){
    let t = parseInt(treeInput.value), v2v = parseFloat(v2Input.value), cft, v1v, th, wd;
    if(typeInput.value === 'log'){
        v1v = parseFloat(v1Input.value); if(!t || !v1v || !v2v) return;
        cft = ((v1v/4)**2 * v2v)/144;
    } else {
        wd = parseFloat(widthInput.value); th = parseFloat(thickInput.value); if(!t || !wd || !th || !v2v) return;
        v1v = wd; cft = (wd * th * v2v)/144;
    }
    let obj = { tree: t, piece: items.filter(i => i.tree == t && i.type === typeInput.value).length + 1, type: typeInput.value, v1: v1v, v2: v2v, thick: th || 0, cft: parseFloat(cft.toFixed(2)) };
    items.push(obj); localStorage.setItem('bfidc_data', JSON.stringify(items));
    v1Input.value = v2Input.value = thickInput.value = widthInput.value = '';
    render(); updatePiece(); treeInput.select();
}

function render(){
    let keyword = searchInput.value?.toLowerCase() || '';
    let filtered = items.filter(i => i.tree.toString().includes(keyword));
    treeStat.innerText = new Set(filtered.map(i => i.tree)).size;
    pieceStat.innerText = filtered.length;
    cftStat.innerText = filtered.reduce((s, i) => s + i.cft, 0).toFixed(2);

    const perPage = 76; let html = "";
    for (let p = 0; p < filtered.length; p += perPage) {
        let pageData = filtered.slice(p, p + perPage);
        let left = pageData.slice(0, 38); let right = pageData.slice(38);
        html += `<div class="report-page">
            <img class="watermark" src="${logoFile}">
            <div class="report-header">
                <h3 style="margin:2px">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂ ‡¶¨‡¶® ‡¶∂‡¶ø‡¶≤‡ßç‡¶™ ‡¶â‡¶®‡ßç‡¶®‡¶Ø‡¶º‡¶® ‡¶ï‡¶∞‡ßç‡¶™‡ßã‡¶∞‡ßá‡¶∂‡¶® (BFIDC)</h3>
                <h3 style="margin:2px; font-size:14px">‡¶∞‡¶æ‡¶¨‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶† ‡¶∏‡¶Ç‡¶ó‡ßç‡¶∞‡¶π‡ßá‡¶∞ ‡¶∏‡¶æ‡¶á‡¶ú ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü</h3>
            </div>
            <div style="display:flex; gap:10px;">
                <div style="flex:1"><table><tr><th>‡¶ó‡¶æ‡¶õ/‡¶™‡¶ø‡¶∏</th><th>‡¶Æ‡¶æ‡¶™</th><th>CFT</th></tr>
                    ${left.map(i => `<tr><td>${i.tree}/${i.piece}</td><td>${i.type==='size'?i.v1+'"x'+i.thick+'"x'+i.v2+"'":i.v1+'"x'+i.v2+"'"}</td><td>${i.cft}</td></tr>`).join('')}</table></div>
                <div style="flex:1"><table><tr><th>‡¶ó‡¶æ‡¶õ/‡¶™‡¶ø‡¶∏</th><th>‡¶Æ‡¶æ‡¶™</th><th>CFT</th></tr>
                    ${right.map(i => `<tr><td>${i.tree}/${i.piece}</td><td>${i.type==='size'?i.v1+'"x'+i.thick+'"x'+i.v2+"'":i.v1+'"x'+i.v2+"'"}</td><td>${i.cft}</td></tr>`).join('')}</table></div>
            </div>
        </div>`;
    }
    printArea.innerHTML = html;
}

function exportExcel(){
    let ws = XLSX.utils.json_to_sheet(items);
    let wb = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb, ws, "Data");
    XLSX.writeFile(wb, "BFIDC_Data.xlsx");
}

function exportWord(){
    let content = document.getElementById('printArea').innerHTML;
    let blob = new Blob(['<html><head><meta charset="UTF-8"></head><body>' + content + '</body></html>'], { type: 'application/msword' });
    let url = URL.createObjectURL(blob);
    let a = document.createElement('a'); a.href = url; a.download = 'BFIDC_Report.doc'; a.click();
}

function backup(){
    let blob = new Blob([JSON.stringify(items)], {type: 'application/json'});
    let a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'BFIDC_Backup.json'; a.click();
}

function importData(event) {
    const reader = new FileReader();
    reader.onload = (e) => { items = JSON.parse(e.target.result); localStorage.setItem('bfidc_data', JSON.stringify(items)); render(); updatePiece(); alert("Data Uploaded!"); };
    reader.readAsText(event.target.files[0]);
}
</script>
</body>
</html>
